{
  "test_cases": [
    {
      "name": "서비스 계정이 Kubernetes 환경에서 접근 (성공)",
      "description": "서비스 계정이 Kubernetes 클러스터 내부 IP에서 접근하는 경우 허용",
      "input": {
        "context": {
          "identity": {
            "user": "svc-trino-reader",
            "groups": ["service-accounts", "team-a"],
            "principal": "svc-trino-reader@example.com"
          },
          "source": {
            "ip": "10.0.1.100"
          },
          "queryId": "20231115_123456_00001_abcde",
          "trinoVersion": "450"
        },
        "action": {
          "type": "QueryAccessControl"
        }
      },
      "expected": {
        "allow": true,
        "reason": "서비스 계정이 Kubernetes 환경에서 접근"
      }
    },
    {
      "name": "서비스 계정이 외부 환경에서 접근 (실패)",
      "description": "서비스 계정이 Kubernetes 클러스터 외부에서 접근하는 경우 차단",
      "input": {
        "context": {
          "identity": {
            "user": "svc-trino-reader",
            "groups": ["service-accounts"]
          },
          "source": {
            "ip": "203.0.113.50"
          }
        },
        "action": {
          "type": "QueryAccessControl"
        }
      },
      "expected": {
        "allow": false,
        "reason": "서비스 계정이 Kubernetes 환경이 아님"
      }
    },
    {
      "name": "일반 사용자가 서비스 계정 이름 패턴 사용 시도 (실패)",
      "description": "일반 사용자가 svc- prefix를 사용하여 서비스 계정처럼 보이게 하는 경우 차단",
      "input": {
        "context": {
          "identity": {
            "user": "svc-malicious-user",
            "groups": ["team-a"]
          }
        },
        "action": {
          "type": "QueryAccessControl"
        }
      },
      "expected": {
        "allow": false,
        "reason": "일반 사용자가 서비스 계정 이름 패턴 사용 차단"
      }
    },
    {
      "name": "일반 사용자가 정상 접근 (성공)",
      "description": "일반 사용자가 자신의 스키마에 접근하는 경우 허용",
      "input": {
        "context": {
          "identity": {
            "user": "alice",
            "groups": ["team-a"]
          }
        },
        "action": {
          "type": "SchemaAccessControl",
          "catalog": "hive",
          "schema": {
            "catalog": "hive",
            "schema": "team_a_schema"
          }
        }
      },
      "expected": {
        "allow": true,
        "reason": "일반 사용자가 허용된 스키마에 접근"
      }
    },
    {
      "name": "서비스 계정이 Kubernetes 환경에서 스키마 접근 (성공)",
      "description": "서비스 계정이 Kubernetes 환경에서 스키마에 접근하는 경우 허용",
      "input": {
        "context": {
          "identity": {
            "user": "svc-analytics",
            "groups": ["service-accounts"]
          },
          "source": {
            "ip": "10.0.2.50"
          }
        },
        "action": {
          "type": "SchemaAccessControl",
          "catalog": "hive",
          "schema": {
            "catalog": "hive",
            "schema": "team_a_schema"
          }
        }
      },
      "expected": {
        "allow": true,
        "reason": "서비스 계정이 Kubernetes 환경에서 접근"
      }
    },
    {
      "name": "세션 속성으로 Kubernetes 환경 지정 (성공)",
      "description": "Trino 세션 속성으로 Kubernetes 환경을 지정한 경우",
      "input": {
        "context": {
          "identity": {
            "user": "svc-trino-writer",
            "groups": ["service-accounts"]
          },
          "session": {
            "environment": "kubernetes"
          }
        },
        "action": {
          "type": "QueryAccessControl"
        }
      },
      "expected": {
        "allow": true,
        "reason": "세션 속성으로 Kubernetes 환경 확인"
      }
    },
    {
      "name": "서비스 계정 그룹에 속한 사용자가 Kubernetes 외부에서 접근 (실패)",
      "description": "LDAP 그룹으로 서비스 계정이지만 Kubernetes 환경이 아닌 경우 차단",
      "input": {
        "context": {
          "identity": {
            "user": "service-reader",
            "groups": ["service-accounts", "team-b"]
          },
          "source": {
            "ip": "192.0.2.100"
          }
        },
        "action": {
          "type": "QueryAccessControl"
        }
      },
      "expected": {
        "allow": false,
        "reason": "서비스 계정이 Kubernetes 환경이 아님"
      }
    }
  ]
}

